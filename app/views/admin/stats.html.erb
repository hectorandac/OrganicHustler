<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<body style="background-color: white;">
<div class="main">


  <div style="padding: 20px; background-color: white">
    <h1 class="text-light">Statistics</h1>
    <hr>
    <div style="overflow: hidden;">
      <button style="float: left; width: 100px; margin: 10px; padding: 5px;" class="btn btn-sp text-light" onclick="document.location = '?days=30'">30 DAYS</button>
      <button style="float: left; width: 100px; margin: 10px; padding: 5px;" class="btn btn-sp text-light" onclick="document.location = '?days=60'">60 DAYS</button>
      <button style="float: left; width: 100px; margin: 10px; padding: 5px;" class="btn btn-sp text-light" onclick="document.location = '?days=100'">100 DAYS</button>
      <button style="float: left; width: 100px; margin: 10px; padding: 5px;" class="btn btn-sp text-light" onclick="document.location = '?days=365'">1 YEAR</button>
    </div>
    <hr>
    <div style="padding: 20px">
      <h2 class="text-light">Visitors count</h2>
      <hr>


      <div id="linechart_material" style="width: 100%; height: 500px"></div>
    </div>

  </div>


  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
      google.charts.load('current', {'packages':['line']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
          var data = new google.visualization.DataTable();
          data.addColumn('string', 'Day');
          data.addColumn('number', 'New users');
          data.addColumn('number', 'Orders');

          data.addRows([
              <% (params['days'] ? params['days'].to_i : 30).downto(0) do |i|%>
              <% day = TempUser.where('created_at >= :s_time AND created_at <= :e_time', s_time: (Time.now.beginning_of_day - i.days), e_time: (Time.now.at_end_of_day - i.days) ) %>
              <% orders = Order.where('created_at >= :s_time AND created_at <= :e_time', s_time: (Time.now.beginning_of_day - i.days), e_time: (Time.now.at_end_of_day - i.days) ) %>
              ['<%= (Time.now - i.days).strftime("%b %d, %Y")  %>', <%= day.size %>, <%= orders.size %>],
              <% end %>
          ]);

          var options = {
              chart: {
                  title: 'Users visiting the web site by day',
                  subtitle: 'New and returning users'
              }
          };

          var chart = new google.charts.Line(document.getElementById('linechart_material'));

          chart.draw(data, google.charts.Line.convertOptions(options));
      }
  </script>


</div>
</body>